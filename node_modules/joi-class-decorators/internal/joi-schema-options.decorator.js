"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.JoiSchemaOptions = void 0;
require("reflect-metadata");
const Joi = require("joi");
const defs_1 = require("./defs");
const helpers_1 = require("./helpers");
function JoiSchemaOptions(...args) {
    let options;
    let groups = [];
    if (helpers_1.argIsJoiValidationOptions(args[0])) {
        options = args[0];
    }
    else if (helpers_1.argIsJoiValidationGroups(args[0]) && helpers_1.argIsJoiValidationOptions(args[1])) {
        groups = args[0];
        options = args[1];
    }
    else {
        throw new Error('Invalid arguments.');
    }
    try {
        Joi.string().options(options);
    }
    catch (error) {
        error.message = `Invalid Joi.ValidationOptions: ${error.message}`;
        throw error;
    }
    return function (target) {
        const optionsMeta = Reflect.getOwnMetadata(defs_1.OPTIONS_PROTO_KEY, target) || new Map();
        const finalGroups = groups.length ? groups : [defs_1.DEFAULT];
        for (const group of finalGroups) {
            if (optionsMeta.has(group)) {
                throw new Error(`Cannot redefine schema options for group ${String(group)} on ${target.constructor.name}`);
            }
            optionsMeta.set(group, options);
        }
        Reflect.defineMetadata(defs_1.OPTIONS_PROTO_KEY, optionsMeta, target);
    };
}
exports.JoiSchemaOptions = JoiSchemaOptions;
